# sudo docker build -t math_playground .
# sudo docker run -d -p 1024:1024 --rm -it math_playground

FROM ubuntu:22.04

# Start from the official Ubuntu base image

# Update package lists and install required packages
RUN apt-get update && apt-get install -y \
    build-essential \
    gcc gcc-multilib \
    libc6-dev \
    make \
    # Clean up to reduce the image size
    && apt-get clean \
    && rm -rf /var/lib/apt/lists/*

# Set the working directory inside the container
WORKDIR /usr/src/app

# Copy the C source file to the working directory
COPY math_playground.c .

# Compile the C source file
RUN gcc -o math_playground math_playground.c


#RUN apt-get update

RUN useradd -d /home/ctf/ -m -p ctf -s /bin/bash ctf
RUN echo "ctf:ctf" | chpasswd

WORKDIR /home/ctf

COPY math_playground .
COPY flag.txt .
COPY ynetd .

RUN chown -R root:root /home/ctf
RUN chmod 755 /home/ctf /home/ctf/math_playground /home/ctf/ynetd 
RUN chmod 744 /home/ctf/flag.txt

USER ctf
EXPOSE 1024
CMD ./ynetd -p 1024 ./math_playground
